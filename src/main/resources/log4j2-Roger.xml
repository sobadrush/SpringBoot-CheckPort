<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="warn" name="MyApp">
    <Properties>
        <Property name="app_name">SpringBoot-CheckPort</Property>
        <!-- <Property name="baseDir">D:/logs</Property> -->
        <!-- <Property name="baseDir">/Users/nsl_admin/Desktop/logs</Property> -->
        <Property name="baseDir">${env:LOG_PATH}</Property> <!-- 使用環境變數 -->
        <Property name="logMsg_pattern">%d{yyyy-MM-dd HH:mm:ss} [%-5p] %c %L %M - %msg%xEx%n</Property>
    </Properties>
    <Appenders>

        <Console name="ConsoleAppender" target="SYSTEM_OUT">
            <PatternLayout pattern="${logMsg_pattern}" />
        </Console>

                        <!-- filePattern="${baseDir}/${app_name}-%d{yyyy-MM-dd HH-mm}-%i.log.gz"> -->
        <RollingFile name="RollingFileAppender" fileName="${baseDir}/${app_name}.log"
                        filePattern="${baseDir}/$${date:yyyy-MM}/$${date:yyyy-MM-dd}/${app_name}-%d{yyyy-MM-dd HH-mm}-%i.log.gz">
            <PatternLayout pattern="${logMsg_pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1"/> <!-- 與 filePattern 最小時間單位匹配，ex: 若為 mm ，則為每1分鐘 -->
                <!-- <CronTriggeringPolicy schedule="0 * * * * ?"/> &lt;!&ndash; 每 1分鐘 觸發一次 &ndash;&gt; -->
                <SizeBasedTriggeringPolicy size="3 MB"/> <!-- 正在寫入的 log 檔，容量到達 3MB 時，觸發滾動 -->
                <!-- <OnStartupTriggeringPolicy /> -->
            </Policies>
            <DefaultRolloverStrategy max="5"> <!-- 與 filePattern 的 %i 相關，每分鐘最多產生 3 個檔案-->

                <Delete basePath="${baseDir}/$${date:yyyy-MM}/$${date:yyyy-MM-dd}" maxDepth="1">
                    <!-- 配置 AND 關係 -->
                    <!-- <IfFileName glob="*/app-*.log.gz"/> -->
                    <IfFileName glob="${app_name}-*.log.gz"/>
                    <!-- <IfLastModified age="90d"/> &lt;!&ndash; 最後修改時間 > 90天 以上的檔案會被刪除 &ndash;&gt; -->
                    <IfLastModified age="10m"/> <!-- 最後修改時間 > 10分鐘以上 的檔案會被刪除 -->
                </Delete>

                <!-- 配置 OR 關係 -->
                <Delete basePath="${baseDir}/$${date:yyyy-MM}/$${date:yyyy-MM-dd}" maxDepth="1">
                    <IfAccumulatedFileSize exceeds="1 MB" /> <!-- 目錄中的 log.gz 總容量達到 1MB 時，刪除目錄中最早建立的 log.gz -->
                    <!-- <IfAccumulatedFileCount exceeds="2" /> &lt;!&ndash; 目錄中的 log.gz 數量達到 2個 時，刪除目錄中最早建立的 log.gz &ndash;&gt; -->
                </Delete>

            </DefaultRolloverStrategy>
        </RollingFile>
    </Appenders>
    <Loggers>
        <Root level="info">
            <AppenderRef ref="ConsoleAppender"/>
            <AppenderRef ref="RollingFileAppender"/>
        </Root>
    </Loggers>
</Configuration>